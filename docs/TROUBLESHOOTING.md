# üîß Troubleshooting Guide

## –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º —É–∑–ª–æ–≤

### –û—à–∏–±–∫–∞: "Invalid handshake ack length" –∏–ª–∏ "Received HTTP response instead of handshake"

**–°–∏–º–ø—Ç–æ–º—ã:**
```
ERROR meshlink_core::p2p::peer: Invalid handshake ack length: 1213486160 bytes (raw bytes: [72, 84, 84, 80], hex: 48545450)
ERROR meshlink_core::node: Handshake failed with 127.0.0.1:8080: Peer error: Invalid handshake ack length...
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–í—Ç–æ—Ä–æ–π —É–∑–µ–ª –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ HTTP –ø–æ—Ä—Ç—É (Web Gateway –∏–ª–∏ API) –≤–º–µ—Å—Ç–æ P2P –ø–æ—Ä—Ç–∞.

**–†–µ—à–µ–Ω–∏–µ:**
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã —É–∫–∞–∑—ã–≤–∞–µ—Ç–µ **P2P –ø–æ—Ä—Ç**, –∞ –Ω–µ API –∏–ª–∏ Gateway –ø–æ—Ä—Ç:

```bash
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –£–∫–∞–∑—ã–≤–∞–µ–º P2P –ø–æ—Ä—Ç
ely start 8080                    # –ü–µ—Ä–≤—ã–π —É–∑–µ–ª –Ω–∞ P2P –ø–æ—Ä—Ç—É 8080
ely start 8081 127.0.0.1:8080     # –í—Ç–æ—Ä–æ–π —É–∑–µ–ª –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ P2P –ø–æ—Ä—Ç—É 8080

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –£–∫–∞–∑—ã–≤–∞–µ–º API –∏–ª–∏ Gateway –ø–æ—Ä—Ç
ely start 8081 127.0.0.1:17080    # 17080 - —ç—Ç–æ API –ø–æ—Ä—Ç, –Ω–µ P2P!
ely start 8081 127.0.0.1:17081    # 17081 - —ç—Ç–æ Gateway –ø–æ—Ä—Ç, –Ω–µ P2P!
```

**–ö–∞–∫ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–æ–π –ø–æ—Ä—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- **P2P –ø–æ—Ä—Ç** - —ç—Ç–æ –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç –∫–æ–º–∞–Ω–¥—ã `ely start <p2p_port>`
  - –ù–∞–ø—Ä–∏–º–µ—Ä: `ely start 8080` ‚Üí P2P –ø–æ—Ä—Ç = 8080
- **API –ø–æ—Ä—Ç** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫ `9000 + P2P –ø–æ—Ä—Ç`
  - –ù–∞–ø—Ä–∏–º–µ—Ä: P2P –ø–æ—Ä—Ç 8080 ‚Üí API –ø–æ—Ä—Ç = 17080
- **Gateway –ø–æ—Ä—Ç** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫ `API –ø–æ—Ä—Ç + 1`
  - –ù–∞–ø—Ä–∏–º–µ—Ä: API –ø–æ—Ä—Ç 17080 ‚Üí Gateway –ø–æ—Ä—Ç = 17081
  - –ò–ª–∏ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —è–≤–Ω–æ: `ely start 8080 --gateway 8000`

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:**

```bash
# Terminal 1: –ü–µ—Ä–≤—ã–π —É–∑–µ–ª
ely start 8080 --gateway 8000
# P2P –ø–æ—Ä—Ç: 8080
# API –ø–æ—Ä—Ç: 17080 (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
# Gateway –ø–æ—Ä—Ç: 8000 (—É–∫–∞–∑–∞–Ω —è–≤–Ω–æ)

# Terminal 2: –í—Ç–æ—Ä–æ–π —É–∑–µ–ª (–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ø–µ—Ä–≤–æ–º—É)
ely start 8081 127.0.0.1:8080 --gateway 8001
# P2P –ø–æ—Ä—Ç: 8081
# –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫: 127.0.0.1:8080 (P2P –ø–æ—Ä—Ç –ø–µ—Ä–≤–æ–≥–æ —É–∑–ª–∞!)
# API –ø–æ—Ä—Ç: 17081 (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
# Gateway –ø–æ—Ä—Ç: 8001 (—É–∫–∞–∑–∞–Ω —è–≤–Ω–æ)

# Terminal 3: –¢—Ä–µ—Ç–∏–π —É–∑–µ–ª (–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫–æ –≤—Ç–æ—Ä–æ–º—É)
ely start 8082 127.0.0.1:8081 --gateway 8002
# P2P –ø–æ—Ä—Ç: 8082
# –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫: 127.0.0.1:8081 (P2P –ø–æ—Ä—Ç –≤—Ç–æ—Ä–æ–≥–æ —É–∑–ª–∞!)
```

---

## –î—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –£–∑–µ–ª –Ω–µ –≤–∏–¥–∏—Ç –¥—Ä—É–≥–∏—Ö —É–∑–ª–æ–≤

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –£–∑–ª—ã –∑–∞–ø—É—â–µ–Ω—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö P2P –ø–æ—Ä—Ç–∞—Ö
2. –£–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π P2P –ø–æ—Ä—Ç –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
3. Firewall –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
4. UDP discovery –≤–∫–ª—é—á–µ–Ω (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω)

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —É–∑–ª–∞
ely status

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–∏—Ä–æ–≤
ely peers
```

### Web Gateway –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –£–∑–µ–ª –∑–∞–ø—É—â–µ–Ω
2. Gateway –ø–æ—Ä—Ç —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: `Web Gateway started on http://127.0.0.1:<port>`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —É–∑–µ–ª —Å —è–≤–Ω—ã–º Gateway –ø–æ—Ä—Ç–æ–º
ely start 8080 --gateway 8000

# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# http://localhost:8000/
# –∏–ª–∏
# http://ely.local:8000/ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω /etc/hosts)
```

### –ö–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ fetch

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –ö–æ–Ω—Ç–µ–Ω—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω: `ely publish <path> <content>`
2. –£–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `node_id` –≤ URL
3. –£–∑–ª—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É
4. TTL –Ω–µ –∏—Å—Ç–µ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10 —Å–µ–∫—É–Ω–¥)

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
ely publish site/index.html "<h1>Hello</h1>"
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å node_id –∏–∑ –≤—ã–≤–æ–¥–∞

# –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
ely fetch ely://<node_id>/site/index.html
```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —É–∑–ª–∞
ely status

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–∏—Ä–æ–≤
ely peers

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
ely inbox 20

# Ping –ø–∏—Ä–∞
ely ping <peer_id>

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
ely watch
```

---

## –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

**–í–∫–ª—é—á–∏—Ç—å debug –ª–æ–≥–∏:**
```bash
RUST_LOG=debug ely start 8080
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —É–∑–ª–∞:**
- –õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å
- AI routing –ª–æ–≥–∏: `core/logs/ai_routing_logs.jsonl`

**–¢–∏–ø–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
- `INFO` - –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- `WARN` - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–æ–±—ã—á–Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
- `ERROR` - –æ—à–∏–±–∫–∏ (–Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å)
